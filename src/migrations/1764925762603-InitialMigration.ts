import { MigrationInterface, QueryRunner } from "typeorm";

export class InitialMigration1764925762603 implements MigrationInterface {
    name = 'InitialMigration1764925762603'

    public async up(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`CREATE TABLE "developer_profiles" ("dev_id" int NOT NULL IDENTITY(1,1), "tech_stack" nvarchar(255) array, "experience_level" nvarchar(255) CONSTRAINT CHK_c78ee9f6599dc43fef0e302836_ENUM CHECK(experience_level IN ('junior','mid','senior','lead','principal')), "work_mode" nvarchar(255) CONSTRAINT CHK_1b8dc154e764be7743e25e1516_ENUM CHECK(work_mode IN ('remote','hybrid','onsite')), "bio" nvarchar(1000), "primary_stressors" nvarchar(255) array, "created_at" datetime2 NOT NULL CONSTRAINT "DF_b6dffa53472eda5252879f79df5" DEFAULT getdate(), "updated_at" datetime2 NOT NULL CONSTRAINT "DF_5949fa5066369363d822011362f" DEFAULT getdate(), "user_id" int, CONSTRAINT "PK_e325bb79838d1cce4969b6c6bbc" PRIMARY KEY ("dev_id"))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "REL_2f3e4590c9e181d9cfba7a7671" ON "developer_profiles" ("user_id") WHERE "user_id" IS NOT NULL`);
        await queryRunner.query(`CREATE TABLE "therapist_profiles" ("therapist_id" int NOT NULL IDENTITY(1,1), "license_number" nvarchar(255) NOT NULL, "specializations" text array, "years_experience" int, "bio" text, "session_rate" decimal(10,2), "availability_slots" nvarchar(MAX), "is_accepting_clients" bit NOT NULL CONSTRAINT "DF_ba5eb27d9670b17d92ea535ea19" DEFAULT 1, "max_clients" int NOT NULL CONSTRAINT "DF_23af53d71780c85d214b8061598" DEFAULT 20, "created_at" datetime2 NOT NULL CONSTRAINT "DF_18a25398fdf52b9a322b12a7294" DEFAULT getdate(), "updated_at" datetime2 NOT NULL CONSTRAINT "DF_53a6bdd863d8d6a8e951b976181" DEFAULT getdate(), "user_id" int, CONSTRAINT "PK_55c6a40722ebd1842eb9a75a273" PRIMARY KEY ("therapist_id"))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "REL_727b50cdd502750ef052abbab1" ON "therapist_profiles" ("user_id") WHERE "user_id" IS NOT NULL`);
        await queryRunner.query(`CREATE TABLE "users" ("user_id" int NOT NULL IDENTITY(1,1), "name" varchar(255) NOT NULL, "email" varchar(255) NOT NULL, "password" varchar(255) NOT NULL, "phone" varchar(255) NOT NULL, "hashedRefreshedToken" varchar(255) NOT NULL, "role" varchar(10) NOT NULL CONSTRAINT "DF_ace513fa30d485cfd25c11a9e4a" DEFAULT 'Dev', "created_at" datetime2 NOT NULL CONSTRAINT "DF_c9b5b525a96ddc2c5647d7f7fa5" DEFAULT getdate(), "updated_at" datetime2 NOT NULL CONSTRAINT "DF_6d596d799f9cb9dac6f7bf7c23c" DEFAULT getdate(), "is_active" bit NOT NULL CONSTRAINT "DF_20c7aea6112bef71528210f631d" DEFAULT 1, "is_verified" bit NOT NULL CONSTRAINT "DF_981f4b052442ff079fc3c0d0ac1" DEFAULT 0, "last_active_at" datetime, CONSTRAINT "PK_96aac72f1574b88752e9fb00089" PRIMARY KEY ("user_id"))`);
        await queryRunner.query(`CREATE TABLE "reminders" ("reminder_id" int NOT NULL IDENTITY(1,1), "title" nvarchar(255) NOT NULL, "type" nvarchar(50) NOT NULL, "content" text, "remind_at" datetime2 NOT NULL, "is_completed" bit NOT NULL CONSTRAINT "DF_174800d800f7437f568cd56e858" DEFAULT 0, "completed_at" datetime2, "created_at" datetime2 NOT NULL CONSTRAINT "DF_ccb2617b224ac05106b0118012e" DEFAULT getdate(), "updated_at" datetime2 NOT NULL CONSTRAINT "DF_c45cf0c84f6e3035a683883ba49" DEFAULT getdate(), "user_id" int, CONSTRAINT "PK_edf33a656cc185762e3ae9e6f34" PRIMARY KEY ("reminder_id"))`);
        await queryRunner.query(`CREATE TABLE "resources" ("resource_id" int NOT NULL IDENTITY(1,1), "title" nvarchar(255) NOT NULL, "description" nvarchar(255) NOT NULL, "content" text, "resource_type" nvarchar(255) CONSTRAINT CHK_372bb8deb7383d8ec2ff89b1a2_ENUM CHECK(resource_type IN ('article','video','audio','exercise','meditation','guide','tool','worksheet','course')) NOT NULL, "media_url" nvarchar(255), "thumbnail_url" nvarchar(255), "duration_minutes" int, "tags" text array, "categories" text array, "target_audience" nvarchar(255), "view_count" int NOT NULL CONSTRAINT "DF_a2db73a9a4e09c1b0867a0e7cf4" DEFAULT 50, "like_count" int NOT NULL CONSTRAINT "DF_55a55f138cff66f3b5ed2434db6" DEFAULT 30, "created_at" datetime2 NOT NULL CONSTRAINT "DF_bb3059bfaa6904b413ca41c8187" DEFAULT getdate(), "updated_at" datetime2 NOT NULL CONSTRAINT "DF_95d35a7eb84b77b449863054757" DEFAULT getdate(), CONSTRAINT "UQ_b87c1565860878798718e1be144" UNIQUE ("description"), CONSTRAINT "PK_b9fa5542581d6107e9bf2f49ac0" PRIMARY KEY ("resource_id"))`);
        await queryRunner.query(`CREATE TABLE "conversations" ("conversation_id" int NOT NULL IDENTITY(1,1), "status" nvarchar(255) NOT NULL CONSTRAINT "DF_517acf7e04a7232adb0c760c4b8" DEFAULT 'active', "last_message_at" datetime, "created_at" datetime2 NOT NULL CONSTRAINT "DF_f0bb90db8338e6dc6c349ece995" DEFAULT getdate(), "updated_at" datetime2 NOT NULL CONSTRAINT "DF_7018433f850e2836a7d9df1b9d7" DEFAULT getdate(), "dev_id" int, "therapist_id" int, CONSTRAINT "PK_c00ef2d6a90778048c6b8150819" PRIMARY KEY ("conversation_id"))`);
        await queryRunner.query(`CREATE TABLE "daily_checkins" ("daily_checkin_id" uniqueidentifier NOT NULL CONSTRAINT "DF_3bfae007d5c4b6df91ae4ae33ff" DEFAULT NEWSEQUENTIALID(), "checkin_type" nvarchar(255) CONSTRAINT CHK_b1b58d423a699bbbbf62f69ed1_ENUM CHECK(checkin_type IN ('morning','evening','custom')) NOT NULL, "mood_score" int, "energy_level" int, "stress_level" int, "productivity_feeling" int, "note" text, "tags" text array, "created_at" datetime2 NOT NULL CONSTRAINT "DF_328494c2d838ab4db3fb088fc5a" DEFAULT getdate(), "user_id" int, CONSTRAINT "PK_3bfae007d5c4b6df91ae4ae33ff" PRIMARY KEY ("daily_checkin_id"))`);
        await queryRunner.query(`CREATE TABLE "conversational_contexts" ("context_id" int NOT NULL IDENTITY(1,1), "context_data" nvarchar(255) NOT NULL, "session_type" nvarchar(255) NOT NULL, "created_at" datetime2 NOT NULL CONSTRAINT "DF_c37bc6421c6721e1cbf4deb3c9a" DEFAULT getdate(), "updated_at" datetime2 NOT NULL CONSTRAINT "DF_ae491aaa4a1dee9f6bb2202ef89" DEFAULT getdate(), "dev_id" int, CONSTRAINT "PK_494b359f9303a6dcf861240f5f2" PRIMARY KEY ("context_id"))`);
        await queryRunner.query(`CREATE TABLE "chatbot_conversations" ("id" uniqueidentifier NOT NULL CONSTRAINT "DF_b0b9e3727249e6c93ac30c14bca" DEFAULT NEWSEQUENTIALID(), "conversation_type" nvarchar(255) CONSTRAINT CHK_05e51a4c0e2481f794618fd173_ENUM CHECK(conversation_type IN ('morning-checkin','midday-checkin','evening-checkin','burnout-assessment','general-chat','reminder-response')) NOT NULL, "messages" nvarchar(MAX), "context" nvarchar(MAX), "isCompleted" bit NOT NULL CONSTRAINT "DF_ecb0348fbf8a732c9211d13cf85" DEFAULT 0, "metadata" nvarchar(MAX), "created_at" datetime2 NOT NULL CONSTRAINT "DF_93d3e736c50002569ca6b063bc2" DEFAULT getdate(), "updated_at" datetime2 NOT NULL CONSTRAINT "DF_41c11a689d18892e7e8f1639b73" DEFAULT getdate(), "user_id" int, CONSTRAINT "PK_b0b9e3727249e6c93ac30c14bca" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE TABLE "messages" ("message_id" int NOT NULL IDENTITY(1,1), "message_type" nvarchar(255) CONSTRAINT CHK_62a3934454a63f96def0999fc0_ENUM CHECK(message_type IN ('text','image','file','voice')) NOT NULL CONSTRAINT "DF_feff3ee71dc55994e964e5ba1db" DEFAULT 'text', "content" text NOT NULL, "media_url" nvarchar(500), "is_read" bit NOT NULL CONSTRAINT "DF_93eb201c7a9603e415301e69a07" DEFAULT 0, "read_at" datetime2, "is_edited" bit NOT NULL CONSTRAINT "DF_ee4376fde588455f9e8f2e9321c" DEFAULT 0, "edited_at" datetime2, "created_at" datetime2 NOT NULL CONSTRAINT "DF_0777b63da90c27d6ed993dc60b2" DEFAULT getdate(), "conversation_id" int, "sender_id" int, "receiver_id" int, CONSTRAINT "PK_6187089f850b8deeca0232cfeba" PRIMARY KEY ("message_id"))`);
        await queryRunner.query(`CREATE TABLE "burnout_assessments" ("assessment_id" int NOT NULL IDENTITY(1,1), "emotionalExhaustion_score" int, "depersonalization_score" int, "personal_accomplishment_score" int, "overall_burnout_score" int, "risk_level" nvarchar(255), "recommendations" text array, "created_at" datetime2 NOT NULL CONSTRAINT "DF_f5a669bbd0416e620b26ce36ce1" DEFAULT getdate(), "user_id" int, CONSTRAINT "PK_20596e858357b8d367d364e2af5" PRIMARY KEY ("assessment_id"))`);
        await queryRunner.query(`CREATE TABLE "blogs" ("blog_id" int NOT NULL IDENTITY(1,1), "title" nvarchar(255) NOT NULL, "content" text NOT NULL, "category" nvarchar(100) NOT NULL, "created_at" datetime2 NOT NULL CONSTRAINT "DF_b4e87d7bb503878ba410f379aaa" DEFAULT getdate(), "updated_at" datetime2 NOT NULL CONSTRAINT "DF_b0f284b0d59608fad411cd1b3f1" DEFAULT getdate(), CONSTRAINT "PK_9728ee7386486ed6752b06983e8" PRIMARY KEY ("blog_id"))`);
        await queryRunner.query(`CREATE TABLE "appointments" ("appointment_id" uniqueidentifier NOT NULL CONSTRAINT "DF_dde485d1b7ca51845c075befb6b" DEFAULT NEWSEQUENTIALID(), "appointment_type" nvarchar(255) NOT NULL CONSTRAINT "DF_6c423c02d125985a886050116bb" DEFAULT 'regular_session', "scheduled_at" datetime NOT NULL, "duration_minutes" int NOT NULL CONSTRAINT "DF_01267db66ea3dd22eb4ebdc7e1e" DEFAULT 50, "status" nvarchar(255) NOT NULL CONSTRAINT "DF_3007a47d97a542e63b3308a69b7" DEFAULT 'scheduled', "meeting_link" nvarchar(255), "meeting_platform" nvarchar(255), "dev_notes" text, "therapist_notes" text, "session_summary" text, "dev_rating" int, "dev_feedback" text, "reminder_sent" bit NOT NULL CONSTRAINT "DF_073417237876dc0abbb95d3c47d" DEFAULT 0, "started_at" datetime2, "ended_at" datetime2, "cancelled_by" int, "cancellation_reason" nvarchar(255), "created_at" datetime2 NOT NULL CONSTRAINT "DF_387464fb81909344c275230cc08" DEFAULT getdate(), "updated_at" datetime2 NOT NULL CONSTRAINT "DF_c5aff8c60e664ef9724f1cae097" DEFAULT getdate(), "dev_id" int, "therapist_id" int, CONSTRAINT "PK_dde485d1b7ca51845c075befb6b" PRIMARY KEY ("appointment_id"))`);
        await queryRunner.query(`ALTER TABLE "developer_profiles" ADD CONSTRAINT "FK_2f3e4590c9e181d9cfba7a76713" FOREIGN KEY ("user_id") REFERENCES "users"("user_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "therapist_profiles" ADD CONSTRAINT "FK_727b50cdd502750ef052abbab1a" FOREIGN KEY ("user_id") REFERENCES "users"("user_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "reminders" ADD CONSTRAINT "FK_586e0b8e419125be507701cee2a" FOREIGN KEY ("user_id") REFERENCES "users"("user_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "conversations" ADD CONSTRAINT "FK_f992e2b6ccb69989bd15b238240" FOREIGN KEY ("dev_id") REFERENCES "developer_profiles"("dev_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "conversations" ADD CONSTRAINT "FK_fc59d071ed09a12a36b00351a06" FOREIGN KEY ("therapist_id") REFERENCES "therapist_profiles"("therapist_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "daily_checkins" ADD CONSTRAINT "FK_de0d5080ef73b34487051099388" FOREIGN KEY ("user_id") REFERENCES "users"("user_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "conversational_contexts" ADD CONSTRAINT "FK_93778cf9664f6865caf7d2e9d6f" FOREIGN KEY ("dev_id") REFERENCES "users"("user_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "chatbot_conversations" ADD CONSTRAINT "FK_04587ca7b98d66cb1684d38b3b2" FOREIGN KEY ("user_id") REFERENCES "users"("user_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "messages" ADD CONSTRAINT "FK_3bc55a7c3f9ed54b520bb5cfe23" FOREIGN KEY ("conversation_id") REFERENCES "conversations"("conversation_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "messages" ADD CONSTRAINT "FK_22133395bd13b970ccd0c34ab22" FOREIGN KEY ("sender_id") REFERENCES "users"("user_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "messages" ADD CONSTRAINT "FK_b561864743d235f44e70addc1f5" FOREIGN KEY ("receiver_id") REFERENCES "users"("user_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "burnout_assessments" ADD CONSTRAINT "FK_73839b89debd0ee6782610ef86e" FOREIGN KEY ("user_id") REFERENCES "users"("user_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "appointments" ADD CONSTRAINT "FK_fcbc7e6226ad390386f7bf58c46" FOREIGN KEY ("dev_id") REFERENCES "users"("user_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "appointments" ADD CONSTRAINT "FK_21813b5b1e7553792e0d1662395" FOREIGN KEY ("therapist_id") REFERENCES "users"("user_id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
    }

    public async down(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`ALTER TABLE "appointments" DROP CONSTRAINT "FK_21813b5b1e7553792e0d1662395"`);
        await queryRunner.query(`ALTER TABLE "appointments" DROP CONSTRAINT "FK_fcbc7e6226ad390386f7bf58c46"`);
        await queryRunner.query(`ALTER TABLE "burnout_assessments" DROP CONSTRAINT "FK_73839b89debd0ee6782610ef86e"`);
        await queryRunner.query(`ALTER TABLE "messages" DROP CONSTRAINT "FK_b561864743d235f44e70addc1f5"`);
        await queryRunner.query(`ALTER TABLE "messages" DROP CONSTRAINT "FK_22133395bd13b970ccd0c34ab22"`);
        await queryRunner.query(`ALTER TABLE "messages" DROP CONSTRAINT "FK_3bc55a7c3f9ed54b520bb5cfe23"`);
        await queryRunner.query(`ALTER TABLE "chatbot_conversations" DROP CONSTRAINT "FK_04587ca7b98d66cb1684d38b3b2"`);
        await queryRunner.query(`ALTER TABLE "conversational_contexts" DROP CONSTRAINT "FK_93778cf9664f6865caf7d2e9d6f"`);
        await queryRunner.query(`ALTER TABLE "daily_checkins" DROP CONSTRAINT "FK_de0d5080ef73b34487051099388"`);
        await queryRunner.query(`ALTER TABLE "conversations" DROP CONSTRAINT "FK_fc59d071ed09a12a36b00351a06"`);
        await queryRunner.query(`ALTER TABLE "conversations" DROP CONSTRAINT "FK_f992e2b6ccb69989bd15b238240"`);
        await queryRunner.query(`ALTER TABLE "reminders" DROP CONSTRAINT "FK_586e0b8e419125be507701cee2a"`);
        await queryRunner.query(`ALTER TABLE "therapist_profiles" DROP CONSTRAINT "FK_727b50cdd502750ef052abbab1a"`);
        await queryRunner.query(`ALTER TABLE "developer_profiles" DROP CONSTRAINT "FK_2f3e4590c9e181d9cfba7a76713"`);
        await queryRunner.query(`DROP TABLE "appointments"`);
        await queryRunner.query(`DROP TABLE "blogs"`);
        await queryRunner.query(`DROP TABLE "burnout_assessments"`);
        await queryRunner.query(`DROP TABLE "messages"`);
        await queryRunner.query(`DROP TABLE "chatbot_conversations"`);
        await queryRunner.query(`DROP TABLE "conversational_contexts"`);
        await queryRunner.query(`DROP TABLE "daily_checkins"`);
        await queryRunner.query(`DROP TABLE "conversations"`);
        await queryRunner.query(`DROP TABLE "resources"`);
        await queryRunner.query(`DROP TABLE "reminders"`);
        await queryRunner.query(`DROP TABLE "users"`);
        await queryRunner.query(`DROP INDEX "REL_727b50cdd502750ef052abbab1" ON "therapist_profiles"`);
        await queryRunner.query(`DROP TABLE "therapist_profiles"`);
        await queryRunner.query(`DROP INDEX "REL_2f3e4590c9e181d9cfba7a7671" ON "developer_profiles"`);
        await queryRunner.query(`DROP TABLE "developer_profiles"`);
    }

}
